<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Booking Form</title>
</head>
<body>
    <h2>Book an Appointment bro</h2>
    <form id="appointmentForm">
        <label for="name">Name:</label><br>
        <input type="text" id="name" name="name" required><br><br>

        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email" required><br><br>

        <label for="phone">Phone:</label><br>
        <input type="text" id="phone" name="phone" required><br><br>

        <button type="submit">Submit</button>
    </form>

    <div id="entriesList" class="entry-list"></div>

    <script>
        document.getElementById('appointmentForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone')
            };

            try {
                const response = await fetch('http://localhost:4000/book_appointment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    loadEntries(); // Reload entries after successful submission
                } else {
                    console.error('Failed to submit form');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });

        async function loadEntries() {
            try {
                const response = await fetch('http://localhost:4000/entries');
                const entries = await response.json();
                const entriesList = document.getElementById('entriesList');
                entriesList.innerHTML = '';

                entries.forEach(entry => {
                    const entryDiv = document.createElement('div');
                    entryDiv.classList.add('entry-item');
                    entryDiv.innerHTML = `
                        ${entry.name} (${entry.email}, ${entry.phone})
                        <button onclick="editEntry(${entry.id})">Edit</button>
                        <button onclick="deleteEntry(${entry.id})">Delete</button>
                    `;
                    entriesList.appendChild(entryDiv);
                });
            } catch (error) {
                console.error('Error loading entries:', error);
            }
        }

        async function editEntry(id) {
            try {
                const response = await fetch(`http://localhost:4000/entry/${id}`);
                const entry = await response.json();

                document.getElementById('name').value = entry.name;
                document.getElementById('email').value = entry.email;
                document.getElementById('phone').value = entry.phone;

                document.getElementById('appointmentForm').dataset.editId = id;
            } catch (error) {
                console.error('Error fetching entry for edit:', error);
            }
        }

        async function deleteEntry(id) {
            try {
                const response = await fetch('http://localhost:4000/delete_entry', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id })
                });

                if (response.ok) {
                    loadEntries(); // Reload entries after deletion
                } else {
                    console.error('Failed to delete entry');
                }
            } catch (error) {
                console.error('Error deleting entry:', error);
            }
        }

        // Load entries on page load
        loadEntries();
    </script>
</body>
</html>
